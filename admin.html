<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم القناة التلفزيونية</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        /* الهيدر */
        .admin-header {
            background: linear-gradient(90deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #00b894;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .back-link {
            color: white;
            text-decoration: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .back-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00b894;
            animation: pulse 2s infinite;
        }
        
        .status-dot.offline {
            background: #ff7675;
        }
        
        /* التبويبات */
        .admin-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            padding: 0 20px;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tab-btn:hover {
            color: #495057;
            background: rgba(0, 0, 0, 0.05);
        }
        
        .tab-btn.active {
            color: #2c3e50;
            border-bottom-color: #00b894;
            background: white;
        }
        
        /* المحتوى */
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* النماذج */
        .form-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f2f6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #00b894;
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        /* الأزرار */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00b894, #00a085);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, #00a085, #008b74);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ff7675, #e66767);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(90deg, #e66767, #d63031);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #00b894, #00a085);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(90deg, #00a085, #008b74);
            transform: translateY(-2px);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* القوائم */
        .list-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .list-item:hover {
            background: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .edit-btn {
            color: #00b894;
        }
        
        .edit-btn:hover {
            background: rgba(0, 184, 148, 0.1);
        }
        
        .delete-btn {
            color: #ff7675;
        }
        
        .delete-btn:hover {
            background: rgba(255, 118, 117, 0.1);
        }
        
        /* المعاينة */
        .preview-container {
            background: #000;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .preview-logo {
            max-width: 200px;
            height: auto;
        }
        
        /* IPTV Channels */
        .channels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .channel-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .channel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .channel-card.active {
            border-color: #00b894;
        }
        
        .channel-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .channel-info {
            padding: 15px;
        }
        
        .channel-info h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        
        .channel-info small {
            color: #6c757d;
            font-size: 12px;
        }
        
        /* للجوال */
        @media (max-width: 768px) {
            .admin-tabs {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                flex: 1;
                min-width: 120px;
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .channels-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* الرسائل */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <!-- الهيدر -->
        <header class="admin-header">
            <div class="header-left">
                <a href="index.html" class="back-link">
                    <i class="fas fa-arrow-right"></i> العودة للبث
                </a>
                <h1><i class="fas fa-tv"></i> لوحة تحكم القناة التلفزيونية</h1>
            </div>
            <div class="header-right">
                <div class="status-indicator">
                    <span class="status-dot" id="status-dot"></span>
                    <span id="status-text">جارٍ التحميل...</span>
                </div>
                <button class="btn btn-primary" onclick="saveAllSettings()">
                    <i class="fas fa-save"></i> حفظ الكل
                </button>
            </div>
        </header>
        
        <!-- التبويبات -->
        <nav class="admin-tabs">
            <button class="tab-btn active" onclick="openTab('broadcast')">
                <i class="fas fa-satellite-dish"></i> البث المباشر
            </button>
            <button class="tab-btn" onclick="openTab('schedule')">
                <i class="fas fa-calendar-alt"></i> الجدول
            </button>
            <button class="tab-btn" onclick="openTab('ads')">
                <i class="fas fa-ad"></i> الإعلانات
            </button>
            <button class="tab-btn" onclick="openTab('iptv')">
                <i class="fas fa-stream"></i> IPTV
            </button>
            <button class="tab-btn" onclick="openTab('settings')">
                <i class="fas fa-cog"></i> الإعدادات
            </button>
        </nav>
        
        <!-- محتوى التبويبات -->
        <div class="tab-content active" id="broadcast">
            <div class="form-section">
                <h3><i class="fas fa-video"></i> إدارة البث المباشر</h3>
                
                <div class="form-group">
                    <label>نوع البث:</label>
                    <select id="broadcast-type" class="form-control" onchange="toggleSourceInput()">
                        <option value="youtube">YouTube Live</option>
                        <option value="iptv">IPTV Stream</option>
                        <option value="video">فيديو مباشر</option>
                    </select>
                </div>
                
                <div id="youtube-input" class="form-group">
                    <label>رابط YouTube:</label>
                    <input type="url" id="youtube-url" class="form-control" 
                           placeholder="https://www.youtube.com/watch?v=...">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        أدخل رابط فيديو YouTube المباشر
                    </small>
                </div>
                
                <div id="iptv-input" class="form-group" style="display: none;">
                    <label>رابط بث IPTV (M3U8):</label>
                    <input type="url" id="iptv-url" class="form-control" 
                           placeholder="https://example.com/stream.m3u8">
                </div>
                
                <div id="video-input" class="form-group" style="display: none;">
                    <label>رابط الفيديو المباشر:</label>
                    <input type="url" id="video-url" class="form-control" 
                           placeholder="https://example.com/video.mp4">
                </div>
                
                <div class="form-group">
                    <label>البرنامج الحالي:</label>
                    <input type="text" id="current-program" class="form-control" 
                           placeholder="اسم البرنامج المعروض حالياً">
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="startBroadcast()">
                        <i class="fas fa-play-circle"></i> بدء البث
                    </button>
                    <button class="btn btn-danger" onclick="stopBroadcast()">
                        <i class="fas fa-stop-circle"></i> إيقاف البث
                    </button>
                    <button class="btn btn-secondary" onclick="testBroadcast()">
                        <i class="fas fa-eye"></i> معاينة
                    </button>
                </div>
            </div>
            
            <div class="preview-container" id="broadcast-preview">
                <div style="text-align: center;">
                    <i class="fas fa-tv fa-3x" style="margin-bottom: 15px;"></i>
                    <p>معاينة البث ستظهر هنا</p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="schedule">
            <div class="form-section">
                <h3><i class="fas fa-clock"></i> إدارة جدول البرامج</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>الوقت:</label>
                        <input type="time" id="program-time" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>اسم البرنامج:</label>
                        <input type="text" id="program-title" class="form-control" 
                               placeholder="اسم البرنامج">
                    </div>
                    <div class="form-group">
                        <label>المدة (دقيقة):</label>
                        <input type="number" id="program-duration" class="form-control" 
                               placeholder="60">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="addProgram()">
                    <i class="fas fa-plus"></i> إضافة برنامج
                </button>
            </div>
            
            <div class="list-container">
                <h3>جدول البرامج</h3>
                <div id="schedule-list">
                    <!-- البرامج ستظهر هنا -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="ads">
            <div class="form-section">
                <h3><i class="fas fa-bullhorn"></i> إدارة الإعلانات</h3>
                
                <div class="form-group">
                    <label>نص الإعلان:</label>
                    <textarea id="ad-text" class="form-control" rows="3" 
                              placeholder="أدخل نص الإعلان..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>مدة العرض (ثانية):</label>
                    <input type="number" id="ad-duration" class="form-control" value="30" min="10" max="120">
                </div>
                
                <button class="btn btn-primary" onclick="addAdvertisement()">
                    <i class="fas fa-plus-circle"></i> إضافة إعلان
                </button>
            </div>
            
            <div class="list-container">
                <h3>الإعلانات النشطة</h3>
                <div id="ads-list">
                    <!-- الإعلانات ستظهر هنا -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="iptv">
            <div class="form-section">
                <h3><i class="fas fa-satellite"></i> إدارة بث IPTV</h3>
                
                <div class="form-group">
                    <label>رفع ملف M3U/M3U8:</label>
                    <input type="file" id="iptv-file" class="form-control" 
                           accept=".m3u,.m3u8" onchange="loadM3UFile(this)">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        قم برفع ملف قائمة القنوات M3U أو أدخل الرابط مباشرة
                    </small>
                </div>
                
                <div class="form-group">
                    <label>أو رابط M3U مباشر:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="url" id="m3u-url" class="form-control" 
                               placeholder="https://example.com/playlist.m3u8">
                        <button class="btn btn-secondary" onclick="loadM3UFromURL()">
                            <i class="fas fa-download"></i> تحميل
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="list-container">
                <h3>قنوات IPTV المتاحة</h3>
                <div class="channels-grid" id="iptv-channels">
                    <!-- قنوات IPTV ستظهر هنا -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="settings">
            <div class="form-section">
                <h3><i class="fas fa-sliders-h"></i> إعدادات القناة</h3>
                
                <div class="form-group">
                    <label>اسم القناة:</label>
                    <input type="text" id="channel-name" class="form-control" 
                           placeholder="اسم القناة التلفزيونية">
                </div>
                
                <div class="form-group">
                    <label>وصف القناة:</label>
                    <textarea id="channel-description" class="form-control" rows="3" 
                              placeholder="وصف مختصر للقناة..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>شعار القناة:</label>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <input type="url" id="logo-url" class="form-control" 
                               placeholder="https://example.com/logo.png">
                        <span style="color: #666;">أو</span>
                        <input type="file" id="logo-file" class="form-control" 
                               accept="image/*" onchange="previewLogo(event)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>موقع الشعار:</label>
                    <select id="logo-position" class="form-control">
                        <option value="top-right">أعلى اليمين</option>
                        <option value="top-left">أعلى اليسار</option>
                        <option value="bottom-right">أسفل اليمين</option>
                        <option value="bottom-left">أسفل اليسار</option>
                        <option value="watermark">علامة مائية</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>شفافية الشعار:</label>
                    <input type="range" id="logo-opacity" class="form-control" 
                           min="10" max="100" value="70">
                    <span id="opacity-value">70%</span>
                </div>
                
                <button class="btn btn-primary" onclick="saveChannelSettings()">
                    <i class="fas fa-save"></i> حفظ الإعدادات
                </button>
            </div>
            
            <div class="preview-container">
                <div style="text-align: center;">
                    <img id="logo-preview" class="preview-logo" 
                         src="https://via.placeholder.com/200x100/0088cc/ffffff?text=شعار+القناة">
                    <p style="margin-top: 15px;">معاينة الشعار</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // البيانات
        let channelData = {
            channel: {
                name: "القناة التلفزيونية",
                logo: "assets/logo.png",
                description: ""
            },
            broadcast: {
                isLive: false,
                type: "youtube",
                url: "",
                currentShow: ""
            },
            schedule: [],
            ads: [],
            iptvChannels: []
        };
        
        // تحميل البيانات
        function loadData() {
            try {
                const saved = localStorage.getItem('tvChannelData');
                if (saved) {
                    channelData = JSON.parse(saved);
                    updateUI();
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            updateStatus();
        }
        
        // حفظ البيانات
        function saveData() {
            localStorage.setItem('tvChannelData', JSON.stringify(channelData));
            updateStatus();
        }
        
        // تحديث الواجهة
        function updateUI() {
            // تحديث إعدادات القناة
            document.getElementById('channel-name').value = channelData.channel.name || '';
            document.getElementById('channel-description').value = channelData.channel.description || '';
            document.getElementById('logo-url').value = channelData.channel.logo || '';
            document.getElementById('logo-preview').src = channelData.channel.logo || 'assets/logo.png';
            
            // تحديث البث
            document.getElementById('broadcast-type').value = channelData.broadcast.type || 'youtube';
            toggleSourceInput();
            
            if (channelData.broadcast.type === 'youtube') {
                document.getElementById('youtube-url').value = channelData.broadcast.url || '';
            } else if (channelData.broadcast.type === 'iptv') {
                document.getElementById('iptv-url').value = channelData.broadcast.url || '';
            }
            
            document.getElementById('current-program').value = channelData.broadcast.currentShow || '';
            
            // تحديث الجدول
            renderSchedule();
            
            // تحديث الإعلانات
            renderAds();
            
            // تحديث قنوات IPTV
            renderIPTVChannels();
        }
        
        // تبديل التبويبات
        function openTab(tabName) {
            // إخفاء جميع المحتويات
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إزالة النشاط من جميع الأزرار
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // عرض المحتوى المطلوب
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // تبديل نوع مصدر البث
        function toggleSourceInput() {
            const type = document.getElementById('broadcast-type').value;
            
            // إخفاء جميع الحقول
            document.getElementById('youtube-input').style.display = 'none';
            document.getElementById('iptv-input').style.display = 'none';
            document.getElementById('video-input').style.display = 'none';
            
            // عرض الحقل المناسب
            if (type === 'youtube') {
                document.getElementById('youtube-input').style.display = 'block';
            } else if (type === 'iptv') {
                document.getElementById('iptv-input').style.display = 'block';
            } else if (type === 'video') {
                document.getElementById('video-input').style.display = 'block';
            }
        }
        
        // بدء البث
        function startBroadcast() {
            const type = document.getElementById('broadcast-type').value;
            let url = '';
            let program = document.getElementById('current-program').value;
            
            if (type === 'youtube') {
                url = document.getElementById('youtube-url').value;
            } else if (type === 'iptv') {
                url = document.getElementById('iptv-url').value;
            } else if (type === 'video') {
                url = document.getElementById('video-url').value;
            }
            
            if (!url) {
                alert('يرجى إدخال رابط البث');
                return;
            }
            
            channelData.broadcast = {
                isLive: true,
                type: type,
                url: url,
                currentShow: program,
                startTime: new Date().toISOString()
            };
            
            saveData();
            
            // تحديث المعاينة
            if (type === 'youtube') {
                const videoId = extractYouTubeId(url);
                if (videoId) {
                    document.getElementById('broadcast-preview').innerHTML = `
                        <iframe width="560" height="315" 
                                src="https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&modestbranding=1"
                                frameborder="0" allowfullscreen>
                        </iframe>
                    `;
                }
            }
            
            showMessage('تم بدء البث بنجاح!', 'success');
        }
        
        // استخراج ID من رابط يوتيوب
        function extractYouTubeId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }
        
        // إيقاف البث
        function stopBroadcast() {
            channelData.broadcast.isLive = false;
            saveData();
            document.getElementById('broadcast-preview').innerHTML = `
                <div style="text-align: center;">
                    <i class="fas fa-tv fa-3x" style="margin-bottom: 15px;"></i>
                    <p>البث متوقف حالياً</p>
                </div>
            `;
            showMessage('تم إيقاف البث', 'info');
        }
        
        // معاينة البث
        function testBroadcast() {
            const type = document.getElementById('broadcast-type').value;
            let url = '';
            
            if (type === 'youtube') {
                url = document.getElementById('youtube-url').value;
                if (url) {
                    const videoId = extractYouTubeId(url);
                    if (videoId) {
                        window.open(`https://www.youtube.com/embed/${videoId}`, '_blank');
                    }
                }
            } else if (type === 'iptv' || type === 'video') {
                url = type === 'iptv' ? 
                    document.getElementById('iptv-url').value : 
                    document.getElementById('video-url').value;
                if (url) {
                    window.open(url, '_blank');
                }
            }
        }
        
        // إضافة برنامج
        function addProgram() {
            const time = document.getElementById('program-time').value;
            const title = document.getElementById('program-title').value;
            const duration = document.getElementById('program-duration').value;
            
            if (!time || !title) {
                alert('يرجى ملء الوقت واسم البرنامج');
                return;
            }
            
            channelData.schedule.push({
                time: time,
                title: title,
                duration: duration + ' دقيقة'
            });
            
            // ترتيب الجدول حسب الوقت
            channelData.schedule.sort((a, b) => a.time.localeCompare(b.time));
            
            saveData();
            renderSchedule();
            
            // مسح الحقول
            document.getElementById('program-time').value = '';
            document.getElementById('program-title').value = '';
            document.getElementById('program-duration').value = '';
            
            showMessage('تم إضافة البرنامج بنجاح', 'success');
        }
        
        // عرض الجدول
        function renderSchedule() {
            const list = document.getElementById('schedule-list');
            list.innerHTML = '';
            
            channelData.schedule.forEach((program, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div>
                        <strong>${program.time}</strong> - ${program.title}
                        <div style="color: #666; font-size: 14px; margin-top: 5px;">
                            ${program.duration || 'غير محدد'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="action-btn edit-btn" onclick="editProgram(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteProgram(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });
        }
        
        // تعديل برنامج
        function editProgram(index) {
            const program = channelData.schedule[index];
            document.getElementById('program-time').value = program.time;
            document.getElementById('program-title').value = program.title.split(' - ')[0];
            document.getElementById('program-duration').value = program.duration ? 
                program.duration.replace(' دقيقة', '') : '';
            
            // حذف البرنامج القديم
            channelData.schedule.splice(index, 1);
            renderSchedule();
        }
        
        // حذف برنامج
        function deleteProgram(index) {
            if (confirm('هل تريد حذف هذا البرنامج؟')) {
                channelData.schedule.splice(index, 1);
                saveData();
                renderSchedule();
                showMessage('تم حذف البرنامج', 'info');
            }
        }
        
        // إضافة إعلان
        function addAdvertisement() {
            const text = document.getElementById('ad-text').value;
            const duration = document.getElementById('ad-duration').value;
            
            if (!text) {
                alert('يرجى إدخال نص الإعلان');
                return;
            }
            
            channelData.ads.push({
                text: text,
                duration: duration,
                createdAt: new Date().toISOString()
            });
            
            saveData();
            renderAds();
            
            document.getElementById('ad-text').value = '';
            showMessage('تم إضافة الإعلان بنجاح', 'success');
        }
        
        // عرض الإعلانات
        function renderAds() {
            const list = document.getElementById('ads-list');
            list.innerHTML = '';
            
            channelData.ads.forEach((ad, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div>
                        <strong>${ad.text}</strong>
                        <div style="color: #666; font-size: 14px; margin-top: 5px;">
                            مدة العرض: ${ad.duration} ثانية
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="action-btn delete-btn" onclick="deleteAd(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });
        }
        
        // حذف إعلان
        function deleteAd(index) {
            if (confirm('هل تريد حذف هذا الإعلان؟')) {
                channelData.ads.splice(index, 1);
                saveData();
                renderAds();
                showMessage('تم حذف الإعلان', 'info');
            }
        }
        
        // تحميل ملف M3U
        function loadM3UFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                parseM3UContent(e.target.result);
            };
            reader.readAsText(file);
        }
        
        // تحميل M3U من رابط
        function loadM3UFromURL() {
            const url = document.getElementById('m3u-url').value;
            if (!url) {
                alert('يرجى إدخال رابط الملف');
                return;
            }
            
            fetch(url)
                .then(response => response.text())
                .then(parseM3UContent)
                .catch(error => {
                    alert('خطأ في تحميل الملف: ' + error.message);
                });
        }
        
        // تحليل محتوى M3U
        function parseM3UContent(content) {
            const lines = content.split('\n');
            const channels = [];
            let currentChannel = {};
            
            lines.forEach(line => {
                line = line.trim();
                
                if (line.startsWith('#EXTINF:')) {
                    const info = line.substring(8);
                    const parts = info.split(',');
                    
                    currentChannel = {
                        name: parts[1] || 'قناة غير معروفة',
                        logo: '',
                        group: 'عام'
                    };
                    
                    // استخراج الشعار والمجموعة
                    const match = line.match(/tvg-logo="([^"]+)"/);
                    if (match) currentChannel.logo = match[1];
                    
                    const groupMatch = line.match(/group-title="([^"]+)"/);
                    if (groupMatch) currentChannel.group = groupMatch[1];
                    
                } else if (line && !line.startsWith('#') && currentChannel.name) {
                    currentChannel.url = line;
                    channels.push({...currentChannel});
                    currentChannel = {};
                }
            });
            
            channelData.iptvChannels = channels;
            saveData();
            renderIPTVChannels();
            showMessage(`تم تحميل ${channels.length} قناة بنجاح`, 'success');
        }
        
        // عرض قنوات IPTV
        function renderIPTVChannels() {
            const grid = document.getElementById('iptv-channels');
            grid.innerHTML = '';
            
            channelData.iptvChannels.forEach((channel, index) => {
                const card = document.createElement('div');
                card.className = 'channel-card';
                card.onclick = () => selectIPTVChannel(channel);
                
                card.innerHTML = `
                    <img src="${channel.logo || 'https://via.placeholder.com/200x120/333/fff?text=IPTV'}" 
                         alt="${channel.name}" 
                         onerror="this.src='https://via.placeholder.com/200x120/333/fff?text=IPTV'">
                    <div class="channel-info">
                        <h4>${channel.name}</h4>
                        <small>${channel.group}</small>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // اختيار قناة IPTV
        function selectIPTVChannel(channel) {
            document.getElementById('broadcast-type').value = 'iptv';
            document.getElementById('iptv-url').value = channel.url;
            toggleSourceInput();
            openTab('broadcast');
            showMessage(`تم اختيار قناة ${channel.name}`, 'info');
        }
        
        // معاينة الشعار
        function previewLogo(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('logo-preview').src = e.target.result;
                document.getElementById('logo-url').value = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // حفظ إعدادات القناة
        function saveChannelSettings() {
            channelData.channel = {
                name: document.getElementById('channel-name').value,
                description: document.getElementById('channel-description').value,
                logo: document.getElementById('logo-url').value,
                logoPosition: document.getElementById('logo-position').value,
                logoOpacity: document.getElementById('logo-opacity').value
            };
            
            saveData();
            showMessage('تم حفظ إعدادات القناة بنجاح', 'success');
        }
        
        // تحديث الشفافية
        document.getElementById('logo-opacity').addEventListener('input', function(e) {
            document.getElementById('opacity-value').textContent = e.target.value + '%';
        });
        
        // حفظ جميع الإعدادات
        function saveAllSettings() {
            saveData();
            
            // إنشاء ملف JSON للصفحة الرئيسية
            const exportData = {
                ...channelData,
                lastUpdated: new Date().toISOString()
            };
            
            // عرض رابط للتنزيل
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'broadcast.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage('تم حفظ جميع الإعدادات وتصدير الملف', 'success');
        }
        
        // تحديث حالة النظام
        function updateStatus() {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            if (channelData.broadcast.isLive) {
                statusDot.className = 'status-dot';
                statusText.textContent = 'البث نشط - ' + 
                    (channelData.broadcast.currentShow || 'برنامج مباشر');
            } else {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'البث متوقف';
            }
        }
        
        // عرض رسالة
        function showMessage(text, type) {
            // إزالة أي رسائل سابقة
            const existingMessages = document.querySelectorAll('.message');
            existingMessages.forEach(msg => msg.remove());
            
            // إنشاء الرسالة الجديدة
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${text}
            `;
            
            // إضافة الرسالة
            const container = document.querySelector('.admin-container');
            container.insertBefore(message, container.children[1]);
            
            // إزالة الرسالة بعد 5 ثواني
            setTimeout(() => {
                message.remove();
            }, 5000);
        }
        
        // التحميل الأولي
        window.onload = function() {
            loadData();
            updateStatus();
            
            // تحديث الحالة كل 10 ثواني
            setInterval(updateStatus, 10000);
        };
    </script>
</body>
</html>